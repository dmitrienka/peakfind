# README

## О программе

peakfind.r - R-скрипт, облегчающий подготовку порошковых CIF для ICDD. Использует готовое уточнение в TOPAS4-2.

## Использование

Обработайте дифрактограмму в TOPAS4-2. Целевая фаза должна быть описана как _hkl Phase_. Убедитесь, что режимы _Show calculated curve_, _Show difference curve_ и _Show background curve_ активны, а режим _Show single peak curves_, напротив, неактивен (после включения режимов необходимо выполнить _Refine_). Экспортируйте данные в текстовый файл (правой кнопкой мыши по паттерну и _Save if displayed..._), например **data.txt**. Сохраните проект, например **icdd.pro**.

Вызывайте скрипт следующим образом:
 
 ````
 > peakfind.r data.txt icdd.pro
 ````
 Будут созданы два файла: диагностическая картинка **check.eps** и каркас CIF **icdd.cif**.
 
## Принцип действия
 
 * Скрипт находит максимумы в расчетных данных (_Ycalc_ из __data.txt__)
 * В окрестности максимумов расчетных данных находятся максимумы экспериментальных данных
 * Для каждой уточненной позиции пика находится ближайший набор индексов (в __icdd.pro__)
 * Строится диагностический график. Все найденные пики отмечаются вертикальными линиями.
 * В шаблон CIF вписываются две таблицы: видимых пиков с наблюдаемыми интенсивностями, и всех пиков hkl с расчетными интегральными интенсивностями. Также в шаблон вписывается экспериментальная дифрактограмма в CIF формате.

## Параметры

### --crop (-c)

Максимальное значение 2Theta, по умолчанию 60.

### --delta (-d)

 В какой окрестности hkl-пика искать максимум экспериментальных данных. По умолчанию 0.037 градуса 2Theta.

### --peak (-p)

Добавить пики руками. Например, добавить три пика на 1.1, 5.987 и 10 градусах 2Theta:

````
 > peakfind.r -p "1.1 5.987 10" data.txt icdd.pro
````
### --threshold (-t)

Удалять пики с относительной интенсивностью меньше этого значения. По умолчанию 0.35.

### ----BkgSub (-b)

Писать в CIF дифрактограмму с вычтенным фоном.

### --help !!!
